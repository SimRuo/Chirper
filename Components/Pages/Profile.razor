@page "/profile"
@using Chirper.Models
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserManager<User> UserManager
@inject NavigationManager NavigationManager

<h3>Your Profile</h3>

@if (currentUser != null)
{
    <div>
        <p><strong>Username:</strong> @currentUser.UserName</p>
        <p><strong>Email:</strong> @currentUser.Email</p>
        <!-- Add more user details if needed -->
    </div>
}
else
{
    <p>Loading...</p>
}

@code {
    private User currentUser;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            // Retrieve the user from the UserManager
            var userId = user.FindFirst(c => c.Type == System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
            if (userId != null)
            {
                currentUser = await UserManager.FindByIdAsync(userId);
            }
        }
        else
        {
            NavigationManager.NavigateTo("/login"); // Redirect to login page if user is not logged in
        }
    }
}
