@using Chirper.Services
@using Chirper.Models
@inject ChirpService ChirpService

<h3>Chirps</h3>

<ul>
    @foreach (var chirp in chirps)
    {
        <li>@chirp.Author: @chirp.Content (@chirp.CreatedAt)</li>
    }
</ul>

<h3>Add Chirp</h3>
<input @bind="newChirpContent" placeholder="What's happening?" />
<button @onclick="() => AddChirp()">Chirp</button>

@code {
    private List<Chirp> chirps = new();
    private string newChirpContent;

    protected override async Task OnInitializedAsync()
    {
        chirps = await ChirpService.GetChirpsAsync();
        Console.WriteLine("Component initialized");

    }

    private async Task AddChirp()
    {
        if (!string.IsNullOrWhiteSpace(newChirpContent))
        {
            Console.WriteLine("Pissknapp");
            var chirp = new Chirp { Content = newChirpContent, Author = "User123" };
            await ChirpService.AddChirpAsync(chirp);
            newChirpContent = string.Empty;
            chirps = await ChirpService.GetChirpsAsync(); // Refresh the list
        }
    }
}
